(function(){requirejs.config({baseUrl:"../scripts",map:{"*":{ko:"knockout"}},shim:{breeze:["Q","jquery","knockout"],sinonie:["sinon"],sigr:["jquery"]},paths:{rx:"rx/rx","rx.binding":"rx/rx.binding",linq:"linqjs-amd",sinon:"sinon-1.10.3",sinonie:"sinon-ie-1.10.3",Q:"q",jquery:"jquery-2.1.1",breeze:"breeze.debug",knockout:"knockout-3.2.0.debug","knockout.punches":"knockout.punches",observableExtensions:"app/newobservableExtensions/observableExtensions","observableExtensions.listener":"App/ObservableExtensions/listener",utils:"app/utils"}});require(["rx","Q","rx.binding"],function(e,b){var a,d,c;d={};c={subscriber:function(g){var f;if(!d[g]){f=e.Observable.create(function(h){d[g].observer=h;return function(){return delete d[g]}});d[g]={subject:f,share:f.share(),subscriptionDeferred:b.defer()};setTimeout(function(){if(d[g]){return d[g].subscriptionDeferred.resolve(function(){return d[g].share})}},1)}return d[g].subscriptionDeferred.promise},retrieve:function(g){var f;f=b.defer();setTimeout(function(){return f.resolve(["retrieve returns data for "+g])},10);return f.promise}};define("retriever",[],function(){return{getMe:function(){return c},initMe:function(){return b()}}});a={getStore:function(f){},getType:function(f){},getCollectionType:function(f){}};define("breezeEntityManagers",[],function(){return{getMe:b(a)}});return require(["linq","knockout","observableExtensions","knockout.punches","sinon","sinonie","retriever"],function(i,h,j,f,k,g,l){h.punches.enableAll();QUnit.asyncTest("check linq",function(m){var n,o,p,q;q=sinon.sandbox.create();n=q.useFakeTimers();o=[];p=0;q.spy(c,"subscriber");q.spy(c,"retrieve");j.initMe().then(function(){var r;r=j.getMe().testManyObservable("rsub")().root.base("base!!!").order("order!!!!!!!!").retrieve().retrieved().subscribe(function(s){return o=s});m.ok(o.length===0,"no data received yet");m.ok(c.subscriber.calledOnce,"we have subscribed to the retriever");m.equal(c.subscriber.args[0][0],"rsub","we've subscribed to the rsub definition");m.ok(!c.retrieve.called,"we have not yet retrieved from the retriever");n.tick(1);n.restore();setTimeout(function(){n=q.useFakeTimers();m.ok(c.retrieve.calledOnce,"we have called retrieve on the retriever");m.equal(c.retrieve.args[0][0],"initialQuery from base base!!! from order order!!!!!!!!","query passed to retriever");m.ok(o.length===0,"still no data");n.tick(20);d.rsub.observer.onNext("yabba 1");d.rsub.observer.onNext("yabba 2");n.restore();return setTimeout(function(){n=q.useFakeTimers();m.ok(o.length===3,"data");m.ok(o[0]==="retrieve returns data for initialQuery from base base!!! from order order!!!!!!!!","received data applied");m.ok(o[1]==="yabba 1","published data applied");m.ok(o[2]==="yabba 2","published data applied");q.restore();return QUnit.start()},20)},1);return;return setTimeout(function(){d.rsub.observer.onNext("yabadabadaba");subscription2.dispose();d.rsub.observer.onNext("yabfevadabadaba");r.dispose();m.ok(o===3);m.ok(p===2);m.ok(d.rsub===void 0);return QUnit.start()},1000)});return n.tick(4)});return QUnit.asyncTest("bind to dom",function(m){return j.initMe().then(function(){var n;n=0;setInterval(function(){if(d.rsub&&d.rsub.observer){return d.rsub.observer.onNext("yabadabadaba "+(n++))}},1000);return h.applyBindings({base1:h.observable("base1"),base2:h.observable("base2"),order1:h.observable("order1"),order2:h.observable("order2"),sub1:j.getMe().testManyObservable("rsub"),sub2:j.getMe().testManyObservable("rsub")})})})})})}).call(this);