(function(){define(["knockout","Q","linq","observableExtensions.listener"],function(a,d,b){var c,e;a.extenders.retrieve=function(g,f){g.retrieve=function(h){f.retrieve();return{retrieved:function(){return g}}};return g};a.extenders.order=function(g,f){g.order=function(h){a.utils.unwrapObservable(h);f.makeQuery(function(i){return""+i+" from order "+(a.utils.unwrapObservable(h))});return g};return g};a.extenders.base=function(g,f){g.base=g.any=function(h){a.utils.unwrapObservable(h);f.clearQuery();f.makeQuery(function(i){return""+i+" from base "+(a.utils.unwrapObservable(h))});return g};return g};c={manyObservable:function(f){return function(){var i,j,k,l,m,n,o,p,q,g,h;p=d.defer();q=p.promise;h=[];g=[];m=void 0;n=function(){m=[];return q.then(function(){var r;r=h.reduce((function(t,s){return s(t)}),"initialQuery");return e.retrieve(r).then(function(v){var u,s,t;j(v);for(s=0,t=m.length;s<t;s++){u=m[s];j.push(u)}return m=void 0})})};i=function(){return h=[]};l=function(r){return h.push(r)};k=function(r){return g.push(r)};o=d.defer();j=a.observableArray().extend({listener:{subscribeActions:function(){var r;r=void 0;return{onSubscribe:function(){var s;s=h.reduce((function(u,t){return t(u)}),"initialQuery");return e.subscriber(f).then(function(t){p.resolve();return r=t.subscribe(function(u){if(m){return m.push(u)}else{return j.push(u)}})})},onDispose:function(){if(r){return r.dispose()}}}}},base:{makeQuery:l,clearQuery:i},order:{makeQuery:l},retrieve:{retrieve:n}});return{root:j}}}};e=void 0;return{getMe:function(){return c},initMe:function(){var f;f=d.defer();require(["retriever"],function(g){e=g.getMe();return f.resolve()});return f.promise}}})}).call(this);