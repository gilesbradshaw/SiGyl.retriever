(function(){define(["knockout","Q","linq","utils","rx","knockout.rx","observableExtensions.listener"],function(c,f,d,h){var a,b,e,g;c.extenders.retrieve=function(j,i){j.retrieve=function(k){i.retrieve();return{retrieved:function(){return j}}};return j};c.extenders.order=function(j,i){j.order=function(k){c.utils.unwrapObservable(k);i.makeQuery(function(l){return""+l+" from order "+(c.utils.unwrapObservable(k))});return j};return j};c.extenders.base=function(j,i){j.base=j.any=function(k){c.utils.unwrapObservable(k);i.clearQuery();i.makeQuery(function(l){return""+l+" from base "+(c.utils.unwrapObservable(k))});return j};return j};b=function(o,s,l,k,t){var m,n,p,q,r,i,j;j=[];i=[];p=void 0;q=void 0;n=void 0;r=f.defer();m=o().extend({listener:{subscribeActions:function(){return{onSubscribe:function(){},onDispose:function(){if(n){return n.dispose()}}}}}});return{data:m,clearQuery:function(){return j=[]},makeQuery:function(u){return j.push(u)},makeMergeFunc:function(u){return i.push(u)},retrieve:function(){var u,v;v=[];u=j.reduce((function(x,w){return w(x)}),k());if(n){n.dispose();n=void 0}return g.subscriber(s()).then(function(x){var w;n=x().subscribe(function(y){if(y.changed){if(p){p.push(y.changed)}else{l(m,void 0,[y.changed])}}if(y.deleted){if(q){return q.push(y.deleted)}else{return l(m,void 0,void 0,[y.deleted])}}});p=[];q=[];w=t.executeQuery(u);w.then(function(y){l(m,y.storedResults,v,q);p=void 0;return q=void 0});return w.fail(function(y){return alert(y)})})}}};e={testManyObservable:function(i,j){return function(){var k;k=b(c.observableArray,function(){return i},function(r,u,q,s){var t,l,m,n,o,p;for(l=0,n=u.length;l<n;l++){t=u[l];r.push(t)}if(q){p=[];for(m=0,o=q.length;m<o;m++){t=q[m];p.push(r.push(t))}return p}},function(){return"initialQuery"},a.getType(j));return{root:k.data.extend({base:{makeQuery:k.makeQuery,clearQuery:k.clearQuery},order:{makeQuery:k.makeQuery},retrieve:{retrieve:k.retrieve}})}}},rootObservable:function(i,j){return function(){var k,l;l=a.getType(j);k=b(c.observable,function(){return""+j+":.:"+i},function(n,q,m,o){var p,r;r=n();if(q&&q.length){p=q[q.length-1]}if(m&&m.length){p=m[m.length-1]}if(p!==r){return n(p)}},function(){var m;m=l.query();m=m.where("Id","==",i);return m},l);return{root:k.data.extend({retrieve:{retrieve:k.retrieve}})}}},manyObservable:function(j,k,i){return function(){var l,m;m=(a.getType(k)).collectionManager(i);l=b(c.observableArray,function(){return m.subscriptionDefinition(j)},function(v,y,u,w){var x,n,o,p,q,r,s,t;if(y){v(y)}if(u){r=d.From(u).Where(function(z){return v().indexOf(z)<0}).ToArray();for(n=0,p=r.length;n<p;n++){x=r[n];v.push(x)}}if(w){s=d.From(w).Where(function(z){return v().indexOf(z)>=0}).ToArray();t=[];for(o=0,q=s.length;o<q;o++){x=s[o];t.push(v.remove(x))}return t}},function(){var n;return n=m.query(j.Id())},m);return{root:l.data.extend({retrieve:{retrieve:l.retrieve}})}}},singleObservable:function(j,k,i){return function(){var l,m;m=(a.getType(i.name)).singleManager(k);l=b(c.observable,function(){return m.subscriptionDefinition(j)},function(o,r,n,p){var q,s;s=o();if(r&&r.length){q=r[r.length-1]}if(n&&n.length){q=n[n.length-1]}if(s!==q){return o(q)}},function(){var n;return n=m.query(j)},m);return{root:l.data.extend({retrieve:{retrieve:l.retrieve}})}}}};g=void 0;a=void 0;return{getMe:function(){return e},initMe:function(){var i;i=f.defer();require(["breezeEntityManagers"],function(j){return j.getMe().then(function(k){a=k;g=k;return i.resolve()})});return i.promise}}})}).call(this);