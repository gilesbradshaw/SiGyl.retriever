(function(){define(["knockout","Q","linq","utils","observableExtensions.listener"],function(c,f,d,h){var a,b,e,g;c.extenders.retrieve=function(j,i){j.retrieve=function(k){i.retrieve();return{retrieved:function(){return j}}};return j};c.extenders.order=function(j,i){j.order=function(k){c.utils.unwrapObservable(k);i.makeQuery(function(l){return""+l+" from order "+(c.utils.unwrapObservable(k))});return j};return j};c.extenders.base=function(j,i){j.base=j.any=function(k){c.utils.unwrapObservable(k);i.clearQuery();i.makeQuery(function(l){return""+l+" from base "+(c.utils.unwrapObservable(k))});return j};return j};b=function(n,s,m,k,t){var l,o,p,q,r,i,j;q=f.defer();r=q.promise;j=[];i=[];o=void 0;p=f.defer();l=n().extend({listener:{subscribeActions:function(){var u;u=void 0;return{onSubscribe:function(){var v;v=j.reduce((function(x,w){return w(x)}),"initialQuery");return g.subscriber(s()).then(function(w){q.resolve();return u=w().subscribe(function(y){if(o){return o.push(y)}else{return m(l,[y])}})})},onDispose:function(){if(u){return u.dispose()}}}}}});return{data:l,clearQuery:function(){return j=[]},makeQuery:function(u){return j.push(u)},makeMergeFunc:function(u){return i.push(u)},retrieve:function(){o=[];return r.then(function(){var u;u=j.reduce((function(w,v){return v(w)}),k());return t.executeQuery(u).then(function(v){m(l,v.results,o);return o=void 0})})}}};e={testManyObservable:function(i,j){return function(){var k;k=b(c.observableArray,function(){return i},function(q,s,t){var r,l,m,n,o,p;for(l=0,n=s.length;l<n;l++){r=s[l];q.push(r)}if(t){p=[];for(m=0,o=t.length;m<o;m++){r=t[m];p.push(q.push(r))}return p}},function(){return"initialQuery"},a.getType(j));return{root:k.data.extend({base:{makeQuery:k.makeQuery,clearQuery:k.clearQuery},order:{makeQuery:k.makeQuery},retrieve:{retrieve:k.retrieve}})}}},rootObservable:function(i,j){return function(){var k,l;l=a.getType(j);k=b(c.observable,function(){return""+j+":.:"+i},function(m,o,p){var n;if(o&&o.length){n=l.store.mergeData(j,o[o.length-1])}if(p&&p.length){n=l.store.mergeData(j,p[o.length-1])}return m(n)},function(){var m;m=l.query;m=m.where("Id","==",i);return m},l);return{root:k.data.extend({retrieve:{retrieve:k.retrieve}})}}}};g=void 0;a=void 0;return{getMe:function(){return e},initMe:function(){var i;i=f.defer();require(["retriever","breezeEntityManagers"],function(k,j){g=k.getMe();return j.getMe().then(function(l){a=l;return i.resolve()})});return i.promise}}})}).call(this);