(function(){define(["knockout","Q","linq","utils","rx","knockout.rx","observableExtensions.listener"],function(c,f,d,i,h){var a,b,e,g;c.extenders.retrieve=function(k,j){k.retrieve=function(l){j.retrieve();return{retrieved:function(){return k}}};return k};c.extenders.order=function(k,j){k.order=function(l){c.utils.unwrapObservable(l);j.makeQuery(function(m){return""+m+" from order "+(c.utils.unwrapObservable(l))});return k};return k};c.extenders.base=function(k,j){k.base=k.any=function(l){c.utils.unwrapObservable(l);j.clearQuery();j.makeQuery(function(m){return""+m+" from base "+(c.utils.unwrapObservable(l))});return k};return k};b=function(n,p,m,l,q){var o,j,k;k=[];j=[];o=h.Observable.create(function(t){var r,s;r=void 0;s=k.reduce((function(v,u){return u(v)}),l());g.subscriber(p()).then(function(x){var u,v,w;u=[];v=[];w=q.executeQuery(s);w.then(function(y){n=m(t,n,y.storedResults,u,v);u=void 0;return v=void 0});w.fail(function(y){return alert(y)});return r=x().subscribe(function(y){if(y.changed){if(u){u.push(y.changed)}else{n=m(t,n,void 0,[y.changed])}}if(y.deleted){if(v){return v.push(y.deleted)}else{return n=m(t,n,void 0,void 0,[y.deleted])}}})});return function(){if(r){return r.dispose()}}});return{data:o.toKoObservable(n),clearQuery:function(){return k=[]},makeQuery:function(r){return k.push(r)},makeMergeFunc:function(r){return j.push(r)},retrieve:function(){}}};e={testManyObservable:function(j,k){return function(){var l;l=b(c.observableArray,function(){return j},function(s,v,r,t){var u,m,n,o,p,q;for(m=0,o=v.length;m<o;m++){u=v[m];s.push(u)}if(r){q=[];for(n=0,p=r.length;n<p;n++){u=r[n];q.push(s.push(u))}return q}},function(){return"initialQuery"},a.getType(k));return{root:l.data.extend({base:{makeQuery:l.makeQuery,clearQuery:l.clearQuery},order:{makeQuery:l.makeQuery},retrieve:{retrieve:l.retrieve}})}}},rootObservable:function(j,k){return function(){var l,m;m=a.getType(k);l=b(void 0,function(){return""+k+":.:"+j},function(s,o,r,n,p){var q,t;t=o;if(r&&r.length){q=r[r.length-1]}if(n&&n.length){q=n[n.length-1]}if(q!==t){s.onNext(q)}return q},function(){var n;n=m.query();n=n.where("Id","==",j);return n},m);return{root:l.data.extend({retrieve:{retrieve:l.retrieve}})}}},manyObservable:function(k,l,j){return function(){var m,n;n=(a.getType(l)).collectionManager(j);m=b([],function(){return n.subscriptionDefinition(k)},function(A,w,z,v,x){var u,y,o,p,q,r,s,t;u=false;if(z){w=z;u=true}if(v){s=d.From(v).Where(function(B){return w().indexOf(B)<0}).ToArray();for(o=0,q=s.length;o<q;o++){y=s[o];w.push(y);u=true}}if(x){t=d.From(x).Where(function(B){return w().indexOf(B)>=0}).ToArray();for(p=0,r=t.length;p<r;p++){y=t[p];w.remove(y);u=true}}if(u){A.onNext(w)}return w},function(){var o;return o=n.query(k.Id())},n);return{root:m.data.extend({retrieve:{retrieve:m.retrieve}})}}},singleObservable:function(k,l,j){return function(){var m,n;n=(a.getType(j.name)).singleManager(l);m=b(void 0,function(){return n.subscriptionDefinition(k)},function(t,p,s,o,q){var r,u;u=p;if(s&&s.length){r=s[s.length-1]}if(o&&o.length){r=o[o.length-1]}if(u!==r){t.onNext(r)}return r},function(){var o;return o=n.query(k)},n);return{root:m.data.extend({retrieve:{retrieve:m.retrieve}})}}}};g=void 0;a=void 0;return{getMe:function(){return e},initMe:function(){var j;j=f.defer();require(["breezeEntityManagers"],function(k){return k.getMe().then(function(l){a=l;g=l;return j.resolve()})});return j.promise}}})}).call(this);