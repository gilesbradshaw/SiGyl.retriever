(function(){var a=function(b,c){return function(){return b.apply(c,arguments)}};define(["jquery","knockout","linq"],function(b,f,g){var h,c,d,e,i;e=(function(j){return function(k,m){var l;if(k._getRetrieveRequest){l=k._getRetrieveRequest(m);if(k._modifyRetrieveRequest){k._modifyRetrieveRequest(l)}}return m}})(this);i=(function(j){return function(k,l){k.cachedRetrieveRequests=[];e(k,k.cachedRetrieveRequests);e(k,l);return l}})(this);d=(function(j){return function(l,k){var m;if(l._getCollectionRetrieveRequest){m=l._getCollectionRetrieveRequest(k);if(l._modifyCollectionRetrieveRequest){l._modifyCollectionRetrieveRequest(m)}}return k}})(this);c=(function(j){return function(l,k){l.cachedCollectionRetrieveRequests=[];d(l,l.cachedCollectionRetrieveRequests);d(l,k);return k}})(this);h=(function(){var j,l;function k(n,m){this.retriever=n;this.data=m;this.modifyCollectionRetrieveRequest=a(this.modifyCollectionRetrieveRequest,this);this.getCollectionRetrieveRequest=a(this.getCollectionRetrieveRequest,this);this.modifyRetrieveRequest=a(this.modifyRetrieveRequest,this);this.getRetrieveRequest=a(this.getRetrieveRequest,this);this.getProcessMetaData=a(this.getProcessMetaData,this);this.getDataMerge=a(this.getDataMerge,this);this.extend=a(this.extend,this);this.cancelIdUnlisten=a(this.cancelIdUnlisten,this);this.processMetaData=a(this.processMetaData,this);this.collectionRetrieveRequestMerge=a(this.collectionRetrieveRequestMerge,this);this.retrieveRequestMerge=a(this.retrieveRequestMerge,this)}j=function(m){return g.From(m.ids).SelectMany(function(n){return n.ParameterGroups}).SelectMany(function(n){return n.Parameters}).Where(function(n){return n.Name==="id"&&n.Id==="id"}).SelectMany(function(n){return n.Values}).Where(function(n){return n.Name==="id"}).Select(function(n){return n.Value}).ToArray()};k.getUnlistens=function(t,n){var m,o,p,q,r,s;s=t.SelectMany(function(v){return v.cachedRetrieveRequests}).GroupBy((function(v){return v.type}),j);if(n){m=n.SelectMany(function(v){return v.cachedRetrieveRequests}).GroupBy((function(v){return v.type}),j)}else{m=g.From([])}s=s.Select(function(v){return{type:v.Key(),ids:v.SelectMany().Where(function(u){return !m.Where(function(w){return w.Key()===v.Key()}).Any(function(w){return w.Any(function(x){return x.indexOf(u)>-1})})}).ToArray()}}).ToArray();q=function(u){return g.From(u.collections).GroupBy((function(v){return v.collection}),j)};p=t.SelectMany(function(v){return v.cachedCollectionRetrieveRequests}).GroupBy((function(v){return v.type}),q);if(n){o=n.SelectMany(function(v){return v.cachedCollectionRetrieveRequests}).GroupBy((function(v){return v.type}),q)}else{o=g.From([])}o=o.Select(function(v){return{type:v.Key(),ids:v.SelectMany(function(u){return u.Select(function(w){return{collection:w.Key(),ids:w.SelectMany()}})})}});p=p.Select(function(v){return{type:v.Key(),ids:v.SelectMany(function(u){return u.Select(function(w){return{collection:w.Key(),ids:w.SelectMany().Where(function(x){return !o.Any(function(y){return y.type===v.Key()&&y.ids.Any(function(z){return z.collection===w.Key()&&z.ids.Any(function(A){return A===x})})})}).ToArray()}}).ToArray()}).ToArray()}}).ToArray();r={ids:s,collections:p};return r};l=0;k.prototype.retrieveRequestMerge=function(m){return i(this,m)};k.prototype.collectionRetrieveRequestMerge=function(m){return c(this,m)};k.prototype.processMetaData=function(m){if(this._getProcessMetaData){this._getProcessMetaData(m)}return m};k.prototype.cancelIdUnlisten=function(y){var t,u,v,w,x,z,A,m,n,o,p,q,r,s;u=[];this.retrieveRequestMerge(u);for(m=0,p=u.length;m<p;m++){t=u[m];x=g.From(y).SingleOrDefault(void 0,function(B){return B.type===t.type});if(x){v=g.From(t.ids).SelectMany(function(B){return B.ParameterGroups}).SelectMany(function(B){return B.Parameters}).Where(function(B){return B.Id==="id"&&B.Name==="id"}).SelectMany(function(B){return B.Values}).Where(function(B){return B.Name==="id"}).Select(function(B){return B.Value}).ToArray();s=g.From(x.ids).SelectMany(function(B){return B.ParameterGroups}).SelectMany(function(B){return B.Parameters}).Where(function(B){return B.Name==="id"&&B.Id==="id"}).ToArray();for(n=0,q=s.length;n<q;n++){w=s[n];A=g.From(w.Values).Where(function(B){return B.Name="id"&&v.indexOf(B.Value)>-1}).ToArray();for(o=0,r=A.length;o<r;o++){z=A[o];w.Values.splice(w.Values.indexOf(z),1)}}}}return y};k.prototype.cancelCollectionUnlisten=function(D){var w,x,y,z,A,B,C,E,F,m,n,o,p,q,r,s,t,u,v;z=[];this.collectionRetrieveRequestMerge(z);for(m=0,q=z.length;m<q;m++){y=z[m];C=g.From(D).SingleOrDefault(void 0,function(G){return G.type===y.type});if(C){u=y.collections;for(n=0,r=u.length;n<r;n++){x=u[n];w=g.From(C.collections).SingleOrDefault(void 0,function(G){return G.collection===x.collection});if(w){A=g.From(x.ids).SelectMany(function(G){return G.ParameterGroups}).SelectMany(function(G){return G.Parameters}).Where(function(G){return G.Id==="id"&&G.Name==="id"}).SelectMany(function(G){return G.Values}).Where(function(G){return G.Name==="id"}).Select(function(G){return G.Value}).ToArray();v=g.From(w.ids).SelectMany(function(G){return G.ParameterGroups}).SelectMany(function(G){return G.Parameters}).Where(function(G){return G.Name==="id"&&G.Id==="id"}).ToArray();for(o=0,s=v.length;o<s;o++){B=v[o];F=g.From(B.Values).Where(function(G){return G.Name="id"&&A.indexOf(G.Value)>-1}).ToArray();for(p=0,t=F.length;p<t;p++){E=F[p];B.Values.splice(B.Values.indexOf(E),1)}}}}}}return D};k.prototype.compare=function(P){var E,F,G,H,I,J,K,L,M,N,O,Q,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;if(this.mixin||P.mixin){return false}if(this.retriever!==P.retriever){return false}M=this.cachedRetrieveRequests||this.retrieveRequestMerge([]);J=P.cachedRetrieveRequests||P.retrieveRequestMerge([]);if(J.length>1||M.length>1){throw"illegal request #1"}if(J.length!==M.length){return false}if((J.length===(y=M.length)&&y===1)){if(J[0].type!==M[0].type){return false}if(J[0].ids.length!==1||M[0].ids.length!==1){throw"illegal request #2"}if(J[0].ids[0].Id!==M[0].ids[0].Id){return false}if(J[0].ids[0].ParameterGroups.length!==1||M[0].ids[0].ParameterGroups.length!==1){throw"illegal request #3"}K=g.From(J[0].ids[0].ParameterGroups[0].Parameters).Where(function(R){return R.Id==="id"}).SelectMany(function(R){return R.Values}).Where(function(R){return R.Name==="id"}).Select(function(R){return R.Value}).ToArray();E=g.From(M[0].ids[0].ParameterGroups[0].Parameters).Where(function(R){return R.Id==="id"}).SelectMany(function(R){return R.Values}).Where(function(R){return R.Name==="id"}).Select(function(R){return R.Value}).ToArray();if(K.length!==E.length||g.From(K).Any(function(R){return E.indexOf(R)<0})){return false}H=g.From(M[0].ids[0].ParameterGroups[0].Parameters).Where(function(R){return R.Id!=="id"}).ToArray();z=g.From(J[0].ids[0].ParameterGroups[0].Parameters).Where(function(R){return R.Id!=="id"}).ToArray();for(m=0,q=z.length;m<q;m++){O=z[m];if(g.From(H).Any(function(R){return !g.From(O).Any(function(S){return S.Id===R.Id&&S.Name===R.Name})})){return false}if(g.From(O).Any(function(R){return !g.From(H).Any(function(S){return S.Id===R.Id&&S.Name===R.Name})})){return false}for(n=0,r=O.length;n<r;n++){N=O[n];G=g.From(H).Single(function(R){return R.Id===N.Id&&R.Name===N.Name});A=N.Values;for(o=0,s=A.length;o<s;o++){Q=A[o];I=g.From(G.Values).SingleOrDefault(void 0,function(R){return R.Name===Q.Name});if(!I||I.Value!==Q.Value){return false}}}}}L=this.cachedCollectionRetrieveRequests||this.collectionRetrieveRequestMerge([]);F=P.cachedCollectionRetrieveRequests||P.collectionRetrieveRequestMerge([]);if(F.length>1||L.length>1){throw"illegal collection request #1"}if(F.length!==L.length){return false}if((F.length===(B=L.length)&&B===1)){if(F[0].type!==L[0].type){return false}if(F[0].collections.length!==1||L[0].collections.length!==1){throw"illegal collection request #2"}if(F[0].collections[0].collection!==L[0].collections[0].collection){return false}if(F[0].collections[0].ids.length!==1||L[0].collections[0].ids.length!==1){throw"illegal collection request #3"}if(F[0].collections[0].ids[0].Id!==L[0].collections[0].ids[0].Id){return false}if(F[0].collections[0].ids[0].ParameterGroups.length!==1||L[0].collections[0].ids[0].ParameterGroups.length!==1){throw"illegal collection request #3"}K=g.From(F[0].collections[0].ids[0].ParameterGroups[0].Parameters).Where(function(R){return R.Id==="id"}).SelectMany(function(R){return R.Values}).Where(function(R){return R.Name==="id"}).Select(function(R){return R.Value}).ToArray();E=g.From(L[0].collections[0].ids[0].ParameterGroups[0].Parameters).Where(function(R){return R.Id==="id"}).SelectMany(function(R){return R.Values}).Where(function(R){return R.Name==="id"}).Select(function(R){return R.Value}).ToArray();if(K.length!==E.length||g.From(K).Any(function(R){return E.indexOf(R)<0})){return false}H=g.From(L[0].collections[0].ids[0].ParameterGroups[0].Parameters).Where(function(R){return R.Id!=="id"}).ToArray();C=g.From(F[0].collections[0].ids[0].ParameterGroups[0].Parameters).Where(function(R){return R.Id!=="id"}).ToArray();for(p=0,t=C.length;p<t;p++){O=C[p];if(g.From(H).Any(function(R){return !g.From(O).Any(function(S){return S.Id===R.Id&&S.Name===R.Name})})){return false}if(g.From(O).Any(function(R){return !g.From(H).Any(function(S){return S.Id===R.Id&&S.Name===R.Name})})){return false}for(w=0,u=O.length;w<u;w++){N=O[w];G=g.From(H).Single(function(R){return R.Id===N.Id&&R.Name===N.Name});D=N.Values;for(x=0,v=D.length;x<v;x++){Q=D[x];I=g.From(G.Values).SingleOrDefault(void 0,function(R){return R.Name===Q.Name});if(!I||I.Value!==Q.Value){return false}}}}}return true};k.prototype.extend=function(m){this.data.extend(m);return this};k.prototype.getDataMerge=function(m){this.dataMerge=m;return this};k.prototype.getProcessMetaData=function(m){this._getProcessMetaData=m;return this};k.prototype.getRetrieveRequest=function(m){this.cachedRetrieveRequests=void 0;this._getRetrieveRequest=m;return this};k.prototype.modifyRetrieveRequest=function(m){this._modifyRetrieveRequest=m;return this};k.prototype.getCollectionRetrieveRequest=function(m){this.cachedCollectionRetrieveRequests=void 0;this._getCollectionRetrieveRequest=m;return this};k.prototype.modifyCollectionRetrieveRequest=function(m){this._modifyCollectionRetrieveRequest=m;return this};return k})();return{getMe:function(){return h}}})}).call(this);