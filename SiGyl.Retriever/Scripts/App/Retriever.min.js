(function(){define(["Q","linq"],function(c,b){var d,a,e;a=6;e=0;return d=(function(){function f(i,j,g){var h;this.retrieve=function(p){var k,l,m,n,o;o=e++;l=c.defer();n=b.From(p).Aggregate([],function(q,r){if(r.retrieveRequestMerge){return r.retrieveRequestMerge(q)}else{return q}})||[];k=b.From(p).Aggregate([],function(q,r){if(r.collectionRetrieveRequestMerge){return r.collectionRetrieveRequestMerge(q)}else{return q}})||[];m=i.invoke("join",o++,n,k);m["catch"](function(q){return l.reject(q)});m.done(function(q){return l.resolve(j.mergeData(q))});return l.promise};this.unlisten=function(n,k){var l,m;l=c.defer();m=i.invoke("leave",n,k);m.done(function(o){return l.resolve(o)});m["catch"](function(o){return l.reject(o)});m["finally"](function(){});return l.promise};h=0;i.on("change",(function(k){return function(n,o,m){var l;if(l=j.changeData(n,o,m)){g.addData(k,l);return g.cycle()}}})(this));i.on("delete",(function(k){return function(m,o,l){var n;n=j.deleteData(m,o,l);if(n){g.deleteData(k,n);return g.cycle()}}})(this))}return f})()})}).call(this);