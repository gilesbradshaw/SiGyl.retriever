(function(){define(["Q","linq","breeze","store","observableExtensions","utils"],function(f,d,a,g,e,h){var b,c;c=function(l){var i,j,k;i=f.defer();j=new a.EntityManager(l);k=j.fetchMetadata();k.done(function(m){return i.resolve({key:m.schema.entityContainer.name,manager:j,metaData:m})});k["catch"](function(){return i.reject()});return i.promise};b=void 0;return{initMe:function(j){var i;e.initMe();b=f.defer();i=f.all(d.From(j).Select(function(k){return c(k)}).ToArray());i.done(function(o){var m,n,k,l;m=[];for(k=0,l=o.length;k<l;k++){n=o[k];n.store=new (g.getMe())(h.getMe().processModel(n.metaData.schema));m.push(e.getMe().create(n.metaData.schema.entityContainer.name,n.metaData.schema))}return f.all(m).done(function(){var p;p=function(q){return d.From(o).Single(function(r){return d.From(r.metaData.schema.entityContainer.entitySet).SingleOrDefault(void 0,function(s){return s.entityType===("Self."+q)})})};return b.resolve({getStore:function(q){return p(q).store},getType:function(r){var q;n=p(r);q=d.From(n.metaData.schema.entityContainer.entitySet).Single(function(s){return s.entityType===("Self."+r)}).name;return{entityContainer:q,query:a.EntityQuery.from(q),manager:n.manager}},getCollectionType:function(r){var q;n=p(r);q=d.From(n.metaData.schema.entityType).Single(function(s){return s.name===r});return{manager:n.manager,entityType:q,collectionManager:function(s){var t,u;u=h.getMe().getDependent(q,s);t=d.From(n.metaData.schema.entityContainer.entitySet).Single(function(v){return v.entityType.split(".")[1]===u.type()}).name;return{query:function(v){return a.EntityQuery.from(t).inlineCount().where(u.id(),"==",v)}}}}}})})});return i["catch"](function(){return b.reject()})},getMe:function(){return b.promise}}})}).call(this);