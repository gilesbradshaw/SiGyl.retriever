(function(){define(["Q","linq","breeze"],function(f,e,a){var b,c,d;d=function(g){var h,i,j,k;h=f.defer();k="http://localhost:41374/breeze/"+g;i=new a.EntityManager(k);j=i.fetchMetadata();j.done(function(l){return h.resolve({manager:i,metaData:l})});j["catch"](function(){return h.reject()});return h.promise};b=f.defer();c=f.all([d("configuration"),d("runtime"),d("history")]);c.done(function(g){return b.resolve({getType:function(j){var h,i;i=e.From(g).Single(function(k){return e.From(k.metaData.schema.entityContainer.entitySet).SingleOrDefault(void 0,function(l){return l.entityType===("Self."+j)})});h=e.From(i.metaData.schema.entityContainer.entitySet).Single(function(k){return k.entityType===("Self."+j)}).name;return{entityContainer:h,query:a.EntityQuery.from(h),manager:i.manager}},getCollectionType:function(j){var h,i;i=e.From(g).Single(function(k){return e.From(k.metaData.schema.entityContainer.entitySet).SingleOrDefault(void 0,function(l){return l.entityType===("Self."+j)})});h=e.From(i.metaData.schema.entityType).Single(function(k){return k.name===j});return{manager:i.manager,entityType:h,collectionManager:function(l){var k,m,n,o,p,q,r;q=e.From(h.navigationProperty).Single(function(s){return s.name===l});r=q.relationship.split(".")[1];k=e.From(i.metaData.schema.association).Single(function(s){return s.name===r});p=k.referentialConstraint.dependent;o=p.propertyRef.name;n=e.From(k.end).Single(function(s){return s.role===p.role});m=e.From(i.metaData.schema.entityContainer.entitySet).Single(function(s){return s.entityType.split(".")[1]===n.type.split(".")[2]}).name;return{query:function(s){return a.EntityQuery.from(m).inlineCount().where(o,"==",s)}}}}}})});c["catch"](function(){return b.reject()});return b.promise})}).call(this);