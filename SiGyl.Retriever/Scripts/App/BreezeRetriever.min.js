(function(){define(["Q","linq","breeze","knockout"],function(d,c,a,b){return function(e){var f,g,h;h="http://localhost:41374/breeze/"+e;f=new a.EntityManager(h);g=f.fetchMetadata();return{get:function(j){var i;i=d.defer();g.done(function(k){var l;l=d.all(c.From(j).Select(function(p){var m,n,o,q,r;r=d.defer();n=c.From(k.schema.entityContainer.entitySet).Single(function(s){return s.entityType===("Self."+p.type)}).name;q=a.EntityQuery.from(n);m=c.From(p.ids).Select(function(s){return a.Predicate.create("Id","==",s.Id)}).ToArray();q=q.where(a.Predicate.or(m));o=f.executeQuery(q);o.done(function(s){return r.resolve({Type:p.type,Ids:c.From(s.results).Select(function(t){return{Key:t.Id(),ParameterGroups:c.From(c.From(p.ids).Single(function(u){return u.Id.toString()===t.Id().toString()}).ParameterGroups).Select(function(u){return{Name:u.Name,Value:[t]}}).ToArray()}}).ToArray()})});o["catch"](function(){return r.reject()});return r.promise}).ToArray());l.done(function(m){return i.resolve(m)});return l["catch"](function(){return i.reject()})});return i.promise},getCollection:function(i){var j;j=d.defer();g.done(function(k){var l;l=d.all(c.From(i).Select(function(p){var m,n,o;o=d.defer();n=c.From(k.schema.entityType).Single(function(q){return q.name===p.type});m=d.all(c.From(p.collections).Select(function(r){var q,s,t,u,v,w,x,y,z;s=d.defer();y=c.From(n.navigationProperty).Single(function(A){return A.name===r.collection});z=y.relationship.split(".")[1];q=c.From(k.schema.association).Single(function(A){return A.name===z});x=q.referentialConstraint.dependent;w=x.propertyRef.name;v=c.From(q.end).Single(function(A){return A.role===x.role});t=c.From(k.schema.entityContainer.entitySet).Single(function(A){return A.entityType.split(".")[1]===v.type.split(".")[2]}).name;u=d.all(c.From(r.ids).Select(function(A){var B,C;B=d.defer();C=d.all(c.From(A.ParameterGroups).Select(function(Q){var M,N,O,P,R,S,T,U,V,D,E,F,G,H,I,J,K,L;R=d.defer();U=a.EntityQuery.from(t).inlineCount().where(w,"==",A.Id);J=c.From(Q.Parameters).Where(function(W){return W.Name==="filter"}).ToArray();for(D=0,G=J.length;D<G;D++){P=J[D];S=c.From(P.Values).Single(function(W){return W.Name==="property"}).Value;M=c.From(P.Values).Single(function(W){return W.Name==="operator"}).Value;V=c.From(P.Values).Single(function(W){return W.Name==="value"}).Value;U=U.where(S,M,V)}K=c.From(Q.Parameters).Where(function(W){return W.Name==="order"}).ToArray();for(E=0,H=K.length;E<H;E++){P=K[E];if(c.From(P.Values).Any(function(W){return W.Name==="isDescending"&&W.Value})){N="orderByDesc"}else{N="orderBy"}T=c.From(P.Values).Single(function(W){return W.Name==="propertyName"}).Value;U=U[N](T)}L=c.From(Q.Parameters).Where(function(W){return W.Name==="page"}).ToArray();for(F=0,I=L.length;F<I;F++){P=L[F];O=c.From(P.Values).Single(function(W){return W.Name==="page"}).Value;U=U.skip(O*10).take(10)}f.executeQuery(U)["catch"](function(){return R.reject()}).done(function(W){return R.resolve({Name:Q.Name,Collection:{data:W.results,metaData:{count:W.inlineCount}}})});return R.promise}).ToArray());C["catch"](function(){return B.reject()}).done(function(D){return B.resolve({Key:A.Id,ParameterGroups:D})});return B.promise}).ToArray());u["catch"](function(){return s.reject()}).done(function(A){return s.resolve({Collection:r.collection,Ids:A})});return s.promise}).ToArray());m["catch"](function(){return o.reject()}).done(function(q){return o.resolve({Type:p.type,Collections:q})});return o.promise}).ToArray());l.done(function(m){return j.resolve(m)});return l["catch"](function(){return j.reject()})});return j.promise}}}})}).call(this);