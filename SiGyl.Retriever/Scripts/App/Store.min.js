(function(){define(["knockout","b64","linq","observableExtensions"],function(d,a,e,g){var i,b,c,f,h,j;h=function(q,n){var p,k,l,m;if(q){if(q.length!==void 0){m=[];for(k=0,l=q.length;k<l;k++){p=q[k];m.push(n(p))}return m}else{return n(q)}}};b=function(n,o,l){var k,m,p;m=e.From(o.navigationProperties).SingleOrDefault(function(q){return q.Key===l}).Value;k=n.associations[m.relationship.split(".")[1]];p=e.From(k.end).Single(function(q){return q.role===m.toRole});return n.entityTypes[p.type.split(".")[2]]};j=function(l,m,k){h(l.property,(function(n){return function(o){if(o.name in m){if(d.isObservable(k[o.name])){return k[o.name](d.utils.unwrapObservable(m[o.name]))}else{return k[o.name]=m[o.name]}}}})(this));return k};c=function(k,l){return d.utils.unwrapObservable(l[k.key.propertyRef.name])};f=function(r,t,q,u){var s,v,w,k,l,m,n,o,p;w={};o=q.property;for(k=0,m=o.length;k<m;k++){v=o[k];w[v.name]=r[v.name]}h(q.flexibleRelations,function(x){return w[x.name]=u[t.entityContainer.name].flexibleRelationObservable(w,x.name,q)});h(q.interModelRelations,function(x){return w[x.name]=u[t.entityContainer.name].interModelRelationObservable(w,x.name,q)});h(q.navigationProperty,function(y){var x,z;x=t.associations[y.relationship.split(".")[1]];z=e.From(x.end).Single(function(A){return A.role===y.toRole});if(z.multiplicity==="*"){w[y.name]=u[t.entityContainer.name].manyObservable(w,q.name,y.name,q);return w[y.name]._navigationProperty=(function(A){return function(){return A}})(y)}else{return w[y.name]=u[t.entityContainer.name].singleObservable(w,y.name,q)}});if(q.histories){w._histories={};p=q.histories;for(l=0,n=p.length;l<n;l++){s=p[l];w._histories[s.name]=u.history.rootObservable(c(q,r),s.name,true)}}if(q.Of){w._runtime=u.runtime.rootObservable(r.RuntimeId,q.Of,true)}w.__conceptualModel=function(){return t};w.__entityType=function(){return q};return w};return i=(function(){function k(l){var m;m=g.getMe().modelExtensions;l.entityTypes={};h(l.entityType,function(n){n.model=l;n.data={};l.entityTypes[n.name]=n;n.navigationProperties={};return h(n.navigationProperty,function(o){return n.navigationProperties[o.name]=o})});l.associations={};h(l.association,function(n){return l.associations[n.name]=n});this.mergeData=(function(n){return function(X,P){var L,M,N,O,Q,R,S,T,U,V,W,Y,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;R=l.entityTypes[X];U=c(R,P);O=R.data[U]||(R.data[U]=f(P,l,R,m));return O;for(o=0,s=P.length;o<s;o++){X=P[o];Q=l.entities[X.Type];if(Q){E=X.Ids;for(p=0,t=E.length;p<t;p++){S=E[p];F=S.ParameterGroups;for(q=0,u=F.length;q<u;q++){V=F[q];if(typeof V.Value!=="string"){W=[];G=V.Value;for(r=0,v=G.length;r<v;r++){Y=G[r];T=c(Q,Y);O=Q.data[T]||(Q.data[T]=f(Y,l,Q,n.modelExtensions));if(!a.compare(Y.Timestamp,O.Timestamp())){j(Q,Y,O);W.push(O)}}V.Value=W}}}H=X.Collections;for(A=0,w=H.length;A<w;A++){L=H[A];N=$.Enumerable.From(Q.navigationProperties).Single(function(Z){return Z.name===L.Collection}).to.type;M=l.entities[N];I=L.Ids;for(B=0,x=I.length;B<x;B++){S=I[B];J=S.ParameterGroups;for(C=0,y=J.length;C<y;C++){V=J[C];W=[];K=V.Collection.data;for(D=0,z=K.length;D<z;D++){Y=K[D];T=c(M,Y);O=M.data[T]||(M.data[T]=f(Y,l,M,n.modelExtensions));if(!a.compare(Y.Timestamp,O.Timestamp())){j(M,Y,O)}W.push(O)}V.Collection.data=W}}}}}return P}})(this);this.changeData=(function(n){return function(q,s,t){var o,p,r;p=l.entityTypes[s.split(".")[0]];if(p){if(s.split(".").length===2){p=b(l,p,s.split(".")[1])}r=c(p,t);o=p.data[r]||(p.data[r]=f(t,l,p,m));if(!a.compare(d.utils.unwrapObservable(t.Timestamp),d.utils.unwrapObservable(o.Timestamp))){j(p,t,o)}return{id:q,type:s,value:o}}}})(this);this.deleteData=function(p,r,s){var n,o,q;o=l.entityTypes[r.split(".")[0]];if(o){if(r.split(".").length===2){o=b(l,o,r.split(".")[1])}q=c(o,s);n=o.data[q];delete o.data[q];return{id:p,type:r,value:n}}}}return k})()})}).call(this);